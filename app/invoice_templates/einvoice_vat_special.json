{
  "name": "einvoice_vat_special",
  "match_rules": {
    "title": {
      "parts": [
        "电子发票",
        "增值税",
        "专用发票"
      ],
      "same_line": true,
      "order": "left_to_right",
      "y_tol": 8,
      "normalize": {
        "remove_whitespace": true,
        "remove_brackets": true,
        "fullwidth_to_halfwidth": true
      },
      "required": true,
      "score": 3
    },
    "anchors": [
      {
        "text": "发票号码",
        "required": true,
        "score": 2
      },
      {
        "text": "开票人",
        "required": true,
        "score": 2
      }
    ],
    "min_score": 5
  },
  "fixed_fields": {
    "invoice_type": "电子发票-增值税专用发票"
  },
  "fields": [
    {
      "name": "invoice_type",
      "path": "invoice_type",
      "type": "string",
      "description": "发票类型",
      "required": true,
      "constraints": {
        "enum": [
          "电子发票-增值税专用发票"
        ]
      }
    },
    {
      "name": "invoice_number",
      "path": "invoice_number",
      "type": "string",
      "description": "发票号码",
      "required": true,
      "constraints": {
        "regex": "^[A-Za-z0-9]{8,}$"
      }
    },
    {
      "name": "issue_date",
      "path": "issue_date",
      "type": "date",
      "description": "开票日期",
      "required": false
    },
    {
      "name": "issuer",
      "path": "issuer",
      "type": "string",
      "description": "开票人",
      "required": true
    },
    {
      "name": "buyer_name",
      "path": "buyer.name",
      "type": "string",
      "description": "购买方名称",
      "required": true
    },
    {
      "name": "buyer_tax_id",
      "path": "buyer.tax_id",
      "type": "string",
      "description": "购买方统一社会信用代码/纳税人识别号",
      "required": true
    },
    {
      "name": "buyer_phone",
      "path": "buyer.phone",
      "type": "string",
      "description": "购买方电话",
      "required": false
    },
    {
      "name": "buyer_address",
      "path": "buyer.address",
      "type": "string",
      "description": "购买方地址",
      "required": false
    },
    {
      "name": "buyer_account_name",
      "path": "buyer.account_name",
      "type": "string",
      "description": "购买方开户银行",
      "required": false
    },
    {
      "name": "buyer_account_no",
      "path": "buyer.account_no",
      "type": "string",
      "description": "购买方银行账号",
      "required": false
    },
    {
      "name": "seller_name",
      "path": "seller.name",
      "type": "string",
      "description": "销售方名称",
      "required": true
    },
    {
      "name": "seller_tax_id",
      "path": "seller.tax_id",
      "type": "string",
      "description": "销售方统一社会信用代码/纳税人识别号",
      "required": true
    },
    {
      "name": "seller_phone",
      "path": "seller.phone",
      "type": "string",
      "description": "销售方电话",
      "required": false
    },
    {
      "name": "seller_address",
      "path": "seller.address",
      "type": "string",
      "description": "销售方地址",
      "required": false
    },
    {
      "name": "seller_account_name",
      "path": "seller.account_name",
      "type": "string",
      "description": "销售方开户银行",
      "required": false
    },
    {
      "name": "seller_account_no",
      "path": "seller.account_no",
      "type": "string",
      "description": "销售方银行账号",
      "required": false
    },
    {
      "name": "total_amount",
      "path": "total_amount",
      "type": "number",
      "description": "合计金额",
      "required": false
    },
    {
      "name": "tax_amount",
      "path": "tax_amount",
      "type": "number",
      "description": "合计税额",
      "required": false
    },
    {
      "name": "amount_with_tax",
      "path": "amount_with_tax",
      "type": "number",
      "description": "价税合计",
      "required": true
    },
    {
      "name": "lines",
      "path": "lines",
      "type": "array",
      "description": "明细行",
      "required": true,
      "items": {
        "type": "object",
        "properties": [
          {
            "name": "name",
            "path": "name",
            "type": "string",
            "description": "项目名称",
            "required": true
          },
          {
            "name": "spec",
            "path": "spec",
            "type": "string",
            "description": "规格型号",
            "required": false
          },
          {
            "name": "unit",
            "path": "unit",
            "type": "string",
            "description": "单位",
            "required": false
          },
          {
            "name": "quantity",
            "path": "quantity",
            "type": "number",
            "description": "数量",
            "required": false
          },
          {
            "name": "unit_price",
            "path": "unit_price",
            "type": "number",
            "description": "单价",
            "required": false
          },
          {
            "name": "amount",
            "path": "amount",
            "type": "number",
            "description": "金额",
            "required": true
          },
          {
            "name": "tax_rate",
            "path": "tax_rate",
            "type": "number",
            "description": "税率/征收率",
            "required": false,
            "constraints": {
              "min": 0
            }
          },
          {
            "name": "tax_amount",
            "path": "tax_amount",
            "type": "number",
            "description": "税额",
            "required": false
          }
        ]
      }
    }
  ],
  "non_table_fields": [
    {
      "name": "invoice_number",
      "target_path": "invoice_number",
      "type": "text",
      "use": "text",
      "anchor_text": {
        "pattern": "发票号码[:：]?\\s*([A-Za-z0-9]+)",
        "match_scope": "line",
        "value_from": "capture",
        "same_line": true,
        "dir": "right",
        "x_gap": [
          5,
          200
        ],
        "y_tol": 6,
        "fallback_right_neighbor": true
      },
      "value_regex": "([A-Za-z0-9]{8,})",
      "allow_extra": true,
      "normalize": {
        "remove_whitespace": true,
        "remove_brackets": true,
        "fullwidth_to_halfwidth": true
      }
    },
    {
      "name": "issue_date",
      "target_path": "issue_date",
      "type": "date",
      "use": "text",
      "anchor_text": {
        "pattern": "开票日期[:：]?\\s*(\\d{4}[-/.年]\\d{1,2}[-/.月]\\d{1,2}[-/.日])",
        "match_scope": "line",
        "value_from": "capture"
      },
      "value_regex": "(\\d{4}[-/.年]\\d{1,2}[-/.月]\\d{1,2}[-/.日])",
      "allow_extra": true,
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      }
    },
    {
      "name": "issuer",
      "target_path": "issuer",
      "type": "text",
      "use": "text",
      "anchor_text": {
        "text": "开票人",
        "same_line": true,
        "dir": "right",
        "x_gap": [
          5,
          160
        ],
        "y_tol": 6,
        "fallback_right_neighbor": true
      },
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      }
    },
    {
      "name": "buyer_name",
      "target_path": "buyer.name",
      "type": "text",
      "use": "both",
      "pos_match_scope": "line",
      "pos_line_y_tol": 6,
      "anchor_pos": {
        "relative_to": "page",
        "region": {
          "x": [
            0.0,
            0.5
          ],
          "y": [
            0.12,
            0.4
          ]
        }
      },
      "anchor_text": {
        "pattern": "名称[:：]?\\s*([^\\s]+)",
        "same_line": true,
        "dir": "right",
        "x_gap": [
          5,
          160
        ],
        "y_tol": 6,
        "fallback_right_neighbor": true
      },
      "allow_extra": false,
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      }
    },
    {
      "name": "buyer_tax_id",
      "target_path": "buyer.tax_id",
      "type": "text",
      "use": "both",
      "pos_match_scope": "line",
      "pos_line_y_tol": 6,
      "anchor_pos": {
        "relative_to": "page",
        "region": {
          "x": [
            0.00,
            0.5
          ],
          "y": [
            0.12,
            0.4
          ]
        }
      },
      "anchor_text": {
        "pattern": "统一社会信用代码/纳税人识别号[:：]?\\s*([A-Za-z0-9]{12,24})",
        "same_line": true,
        "dir": "right",
        "x_gap": [
          5,
          160
        ],
        "y_tol": 6,
        "fallback_right_neighbor": true
      },
      "value_regex": "([A-Za-z0-9]{12,24})",
      "allow_extra": false,
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      }
    },
    {
      "name": "seller_name",
      "target_path": "seller.name",
      "type": "text",
      "use": "both",
      "pos_match_scope": "line",
      "pos_line_y_tol": 6,
      "anchor_pos": {
        "relative_to": "page",
        "region": {
          "x": [
            0.5,
            1.0
          ],
          "y": [
            0.12,
            0.4
          ]
        }
      },
      "anchor_text": {
        "pattern": "名称[:：]?\\s*([^\\s]+)",
        "same_line": true,
        "dir": "right",
        "x_gap": [
          5,
          160
        ],
        "y_tol": 6,
        "fallback_right_neighbor": true
      },
      "allow_extra": false,
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      }
    },
    {
      "name": "seller_tax_id",
      "target_path": "seller.tax_id",
      "type": "text",
      "use": "both",
      "pos_match_scope": "line",
      "pos_line_y_tol": 6,
      "anchor_pos": {
        "relative_to": "page",
        "region": {
          "x": [
            0.5,
            1.0
          ],
          "y": [
            0.12,
            0.4
          ]
        }
      },
      "anchor_text": {
        "pattern": "统一社会信用代码/纳税人识别号[:：]?\\s*([A-Za-z0-9]{12,24})",
        "same_line": true,
        "dir": "right",
        "x_gap": [
          5,
          160
        ],
        "y_tol": 6,
        "fallback_right_neighbor": true
      },
      "value_regex": "([A-Za-z0-9]{12,24})",
      "allow_extra": false,
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      }
    }
  ],
  "table": {
    "header": [
      "项目名称",
      "规格型号",
      "单位",
      "数量",
      "单价",
      "金额",
      "税率/征收率",
      "税额"
    ],
    "header_match": {
      "normalize": {
        "remove_whitespace": true,
        "fullwidth_to_halfwidth": true
      },
      "merge_tokens": {
        "merge_single_char": true,
        "max_x_gap": 40
      },
      "y_tol": 8,
      "min_hit": 8
    },
    "column_map": {
      "项目名称": "name",
      "规格型号": "spec",
      "单位": "unit",
      "数量": "quantity",
      "单价": "unit_price",
      "金额": "amount",
      "税率/征收率": "tax_rate",
      "税额": "tax_amount"
    },
    "first_column_left": 0.0,
    "boundary_by_header_end": [
      "单价",
      "金额",
      "税率/征收率",
      "税额"
    ],
    "assign_rule": {
      "mode": "by_x",
      "x_tol": 10
    },
    "row_group": {
      "mode": "anchor",
      "anchor_required": [
        "name"
      ],
      "anchor_any": [
        "spec",
        "unit",
        "quantity",
        "unit_price",
        "amount",
        "tax_rate",
        "tax_amount"
      ],
      "anchor_skip_before_sum": true,
      "y_gap": 15,
      "allow_blank": true,
      "blank_row_max": 3,
      "ignore_blank": true,
      "joiner": "",
      "merge_join": [
        "name",
        "spec",
        "unit"
      ],
      "merge_first": [
        "quantity",
        "unit_price",
        "amount",
        "tax_rate",
        "tax_amount"
      ]
    },
    "row_end": {
      "stop_anchors": [
        "开票人"
      ]
    },
    "sum_row": {
      "key": "合计",
      "required": true,
      "normalize": {
        "remove_whitespace": true
      },
      "merge_tokens": {
        "merge_single_char": true,
        "max_x_gap": 40
      },
      "neighbor_search": {
        "max_lines_up": 2,
        "max_lines_down": 2,
        "stop_anchor": "小写"
      },
      "targets": {
        "amount": "total_amount",
        "tax_amount": "tax_amount",
        "amount_with_tax": "amount_with_tax"
      }
    },
    "required_fields": [
      "name",
      "amount"
    ]
  }
}
